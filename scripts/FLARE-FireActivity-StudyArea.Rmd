---
title: "Flare-FireActivity-StudyArea"
author: "Anna Talucci"
date: "5/10/2021"
output: html_document
---
# Overview

Skeleton for developing a map figure for FLARE UAS vegetation paper

This script is reliant on
* `Rproj` and therefore the `wd()`does not have to be set
* Relative path names "../folder-name/file-name.ext"
* This script is reliant on the following folders 
    +"../scripts/" --this houses all scripts written in RMarkdown
    +"../data/shapfiles/" --this houses shape files
    +"../figures/
* Please reference the Git Hub repository called **FLARE-UAV-veg** to see the file structure used here

# Packages
```{r}
library(rgdal)
library(raster)
library(ggplot2)
library(maptools)
library(rgeos)
library(sp)
library(mapproj)
library(sf)
library(RStoolbox)
library(ggspatial)
library(cowplot)
library(dplyr)
library(RColorBrewer)
```


# Projections 

Russia Equal area projection

```{r}
ea_ru = "+proj=aea +lat_1=50 +lat_2=70 +lat_0=56 +lon_0=100 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs "
```


# Data

## World map
https://datacatalog.worldbank.org/dataset/world-bank-official-boundaries

```{r}
wrld = st_read("../data/shapefiles/world/WB_countries_Admin0_10m.shp", "WB_countries_Admin0_10m")
```

## Ecozones
```{r}
eco = st_read("../data/ecozones/ne_siberia_ecozones9_ee.shp", "ne_siberia_ecozones9_ee")
```

```{r}
head(eco)
```

## Cities
```{r}
chersky = st_sf(geometry = st_sfc(st_point(c(161.399713, 68.739907))), crs = ("+proj=longlat +datum=WGS84 +no_defs"))

chersky
```

```{r}
yakutsk = st_sf(geometry = st_sfc(st_point(c(129.7422, 62.0397))), crs = ("+proj=longlat +datum=WGS84 +no_defs"))

yakutsk
```

## Arctic Circle 
Arctic Circle shapefile came from [Natural Earth](https://www.naturalearthdata.com/downloads/110m-physical-vectors/110m-geographic-lines/)

```{r}
circle = st_read("../data/ne_110m_geographic_lines/ne_110m_geographic_lines.shp", "ne_110m_geographic_lines") 
```
```{r}
arctic = circle %>% filter(name=="Arctic Circle")
```




# Filter

## Filter countries
```{r}
target_cnty = c("Mongolia", "Kazakhstan", "Japan", "People's Republic of China", "Russia", "Uzbekistan")
```

```{r}
target_iso = c("MN", "RU", "CN", "KZ", "KG", "UZ", "JP", "TM")
```

```{r}
target = c("Asia", "Europe")
```

Filter for all
```{r}
asia  = wrld %>% 
  filter(CONTINENT %in% target) %>%
  dplyr::select( OBJECTID:FORMAL_EN, NAME_EN, ISO_A2, CONTINENT:REGION_WB, Shape_Leng:geometry) 
```

```{r}
asia
```

## Filter ecozones
```{r}
eco = eco %>% filter(BIOME!="8")
```

# Reproject

```{r}
asia_ea = st_transform(asia, crs = ea_ru)
ch_ea = st_transform(chersky, crs = ea_ru)
yak_ea = st_transform(yakutsk, crs = ea_ru)
eco_ea = st_transform(eco, crs = ea_ru)
artic_ea = st_transform(arctic, crs = ea_ru)

```

```{r}
plot(asia_ea$geometry)
```

```{r}
asia_ea
```

# Color Palette
```{r}
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

```{r}
ecoPalette <- c("#CB453D", "#44CB30", "#2E41C3", "#36A4B4", "#B83491", "#B09C32", "#AE3D5F", "#2DC086", "#3261A1")
```

```{r}
eco_ea$eco_code
```

## Russia Map
xmin: -4334205 ymin: -3922562 xmax: 5433752 ymax: 3493703

+
     xlab("Longitude") + 
   ylab("Latitude") +
  theme(panel.grid.major = element_line(color = gray(0.5), linetype = "dashed", 
        size = 0.5), panel.background = element_rect(fill = "aliceblue"))

Background color #C5D8D7

xmin: -13049610 ymin: -6614424 xmax: 6034662 ymax: 11163640

theme(
  panel.background = element_rect(fill = "lightblue",
                                colour = "lightblue",
                                size = 0.5, linetype = "solid"),
## Legend
```{r eval=FALSE, fig.height=5, fig.width=6, include=FALSE}
sa_legend <- ggplot() +
     geom_sf(data = asia_ea, fill = "#C0C0C0", colour="#A9AB9D") +
      geom_sf(data = eco_ea,  aes(fill=ECO_NAME), colour = NA) +
  geom_sf(data=artic_ea, fill=NA, colour = "#FFFFFF", lwd=1, linetype="dashed") +
  scale_fill_manual(values=cbbPalette, labels = c("BT", "CKMT", "CPT", "EST", "NSCT", "NST", "SSFS",  "TCST", "TBBMT")) +
coord_sf(xlim = c(-2934205, 4133752), ylim = c(-1122562, 3493703)) +
  theme(panel.grid.major = element_line(color = gray(0.5), linetype = "dashed", 
        size = 0.5), panel.background = element_rect(fill = "aliceblue")) +
  theme(legend.title = element_blank(), 
        legend.position = c(.5, .1), 
        legend.key.height = unit(.1, 'in'), 
        legend.key.width = unit(.1, 'in'),
        legend.background = element_rect(fill=alpha('white', 0.0)),
         axis.text.x=element_blank(),
        axis.ticks.x=element_blank(), 
        axis.text.y=element_blank(), 
        axis.ticks.y=element_blank(), 
        plot.margin=grid::unit(c(0,0,0,0), "mm")) +
  guides(fill=guide_legend(ncol=9,byrow=FALSE))


sa_legend
```

## Main Map
```{r fig.height=5, fig.width=6}
sa_map <- ggplot() +
    geom_sf(data = asia_ea, fill = "#C0C0C0", colour="#A9AB9D") +
    geom_sf(data = eco_ea,  aes(fill=ECO_NAME), colour = NA) +
  scale_fill_manual(values=cbbPalette, labels = c("BT", "CKMT", "CPT", "EST", "NSCT", "NST", "SSFS",  "TCST", "TBBMT")) +
    geom_sf(data=artic_ea, fill=NA, colour = "#FFFFFF", lwd=1, linetype="dashed") +
    
  geom_sf(data=ch_ea, colour="#FFFFFF") +
  geom_sf(data=yak_ea, colour="#FFFFFF") +
  coord_sf(xlim = c(-2934205, 4133752), ylim = c(-1122562, 3493703)) +
  theme(panel.grid.major = element_line(color = gray(0.5), linetype = "dashed", 
        size = 0.5), 
        panel.background = element_rect(fill = "#C5D8D7")) +
  annotation_scale(location = "bl", width_hint = 0.25, text_size = 12, text_face = "bold", text_family = "sans", text_col = "white") +
  theme(legend.title = element_blank(), 
        legend.position = c(.65, .04), 
        legend.key.height = unit(.1, 'in'), 
        legend.key.width = unit(.1, 'in'),
        legend.background = element_rect(fill=alpha('white', 0.0)),
         axis.text.x=element_blank(),
        axis.ticks.x=element_blank(), 
        axis.text.y=element_blank(), 
        axis.ticks.y=element_blank()) +
  guides(fill=guide_legend(ncol=9,byrow=FALSE))


sa_map
```
## Cowplot Legend
```{r}
legend <- get_legend(sa_legend )
```

## Add Labels

```{r fig.height=5, fig.width=6}
map1 = cowplot::ggdraw(sa_map) + 
  draw_label(label="Russia", fontfamily = "sans", fontface = "plain", color = "black", size = 11, x=.36, y=.45) +
  draw_label(label="China", fontfamily = "sans", fontface = "plain", color = "black", size = 11, x=.67, y=.2) +
  draw_label(label="Mongolia", fontfamily = "sans", fontface = "plain", color = "black", size = 11,  x=.45, y=.2) +
  draw_label(label="Kazakhstan", fontfamily = "sans", fontface = "plain", color = "black", size = 11,  x=.17, y=.25) +
      draw_label(label="Japan", fontfamily = "sans", fontface = "plain", color = "black", size = 11, x=.85, y=.23) +
  draw_label(label="Arctic Circle", fontfamily = "sans", fontface = "plain", color = "white", size = 10,  x=.45, y=.54) +
  draw_label(label="Yakutsk", fontfamily = "sans", fontface = "plain", color = "white", size = 10,  x=.66, y=.48) +
  draw_label(label="Chersky", fontfamily = "sans", fontface = "bold", color = "white", size = 9,  x=.74, y=.715)

map1
```


```{r}
ggsave("../figures/FLARE_FireActivty_StudyArea.png", plot = map1, width = 6, height = 5, units = c("in"), dpi = 600)
```


# References

Olson, D. M., Dinerstein, E., Wikramanayake, E. D., Burgess, N. D., Powell, G. V. N., Underwood, E. C., D'Amico, J. A., Itoua, I., Strand, H. E., Morrison, J. C., Loucks, C. J., Allnutt, T. F., Ricketts, T. H., Kura, Y., Lamoreux, J. F., Wettengel, W. W., Hedao, P., Kassem, K. R. 2001. Terrestrial ecoregions of the world: a new map of life on Earth. Bioscience 51(11):933-938.